<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KNOCK — Fixed Wheel (no bounce)</title>
<style>
  :root{--bg:#071427;--muted:#9aa4b2;--text:#e7eef8;--item-h:84px;--wheel-w:140px}
  *{box-sizing:border-box}html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:#041022;color:var(--text)}
  body{display:flex;align-items:center;justify-content:center;padding:28px}
  .card{width:100%;max-width:760px;background:linear-gradient(180deg,#0b2233,#071427);border-radius:18px;padding:22px}
  .main{display:flex;gap:22px;align-items:flex-start}
  .wheel{width:var(--wheel-w);height:calc(var(--item-h)*3);overflow-y:auto;scroll-snap-type:y mandatory;padding:0;border-radius:12px;background:rgba(0,0,0,0.12);position:relative}
  .wheel ul{list-style:none;margin:0;padding:0}
  .wheel li{height:var(--item-h);line-height:var(--item-h);text-align:center;font-weight:700;color:var(--muted);scroll-snap-align:center;margin:6px 8px;border-radius:10px;transition:all .12s}
  .wheel li.selected{color:var(--text);background:rgba(124,92,255,0.08);transform:scale(1.03)}
  .spacer{pointer-events:none;background:transparent;margin:0;padding:0}
  .slot{position:absolute;left:6px;right:6px;top:50%;transform:translateY(-42px);height:84px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);pointer-events:none;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
  .right{flex:1}
  .selected-value{padding:12px 14px;border-radius:10px;background:rgba(255,255,255,0.02);margin-bottom:14px;font-weight:700}
  .acc-item{background:rgba(0,0,0,0.12);border-radius:10px;margin-bottom:10px;overflow:hidden}
  .acc-head{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;cursor:pointer}
  .acc-title{font-weight:700}
  .acc-sub{color:var(--muted);font-size:13px}
  .acc-body{padding:12px 16px;border-top:1px solid rgba(255,255,255,0.02);display:none}
</style>
</head>
<body>
  <div class="card" role="main">
    <h3 style="margin:0 0 8px 0">KNOCK — Letter Picker</h3>
    <p style="margin:0 0 16px 0;color:var(--muted)">Wheel shows A–Z. Emotions appear if present in DATA.</p>

    <div class="main">
      <div style="position:relative">
        <div class="wheel" id="wheel" role="listbox" tabindex="0" aria-label="Letter wheel">
          <ul id="wheelList" aria-live="polite"></ul>
          <div class="slot" aria-hidden="true"></div>
        </div>
      </div>

      <div class="right">
        <div style="font-size:13px;color:var(--muted);margin-bottom:6px">Selected</div>
        <div id="selectedValue" class="selected-value">—</div>
        <div id="accordion"></div>
      </div>
    </div>
  </div>

<script>
  // sample DATA (emotions only where present)
  const DATA = {
    A: { Anxiety:[{verse:"Phil 4:6-7",text:"Do not be anxious..."},{verse:"1 Pet 5:7",text:"Cast all your anxiety on him."}], Anger:[{verse:"Eph 4:26",text:"In your anger do not sin."}] },
    B:{}, C:{}, D:{}, E:{}, F:{}, G:{}, H:{}, I:{}, J:{}, K:{}, L:{}, M:{}, N:{}, O:{}, P:{}, Q:{}, R:{}, S:{}, T:{}, U:{}, V:{}, W:{}, X:{}, Y:{}, Z:{}
  };

  const LETTERS = Array.from({length:26}, (_,i)=>String.fromCharCode(65+i));
  const wheel = document.getElementById('wheel');
  const wheelList = document.getElementById('wheelList');
  const selectedValue = document.getElementById('selectedValue');
  const accordion = document.getElementById('accordion');

  // flag to ignore scroll events while programmatic snapping is active
  let isSnapping = false;
  let snapTimer = null;

  function buildWheel(){
    wheelList.innerHTML = '';
    // append real letters
    LETTERS.forEach(L=>{
      const li = document.createElement('li');
      li.textContent = L;
      li.dataset.letter = L;
      li.setAttribute('role','option');
      wheelList.appendChild(li);
    });

    // add spacers after layout so first/last can center
    requestAnimationFrame(()=>{
      const realItem = wheelList.querySelector('li[data-letter]');
      if(!realItem) return;
      const itemH = realItem.getBoundingClientRect().height;
      const wheelH = wheel.getBoundingClientRect().height;
      const spacerH = Math.max(0, (wheelH - itemH) / 2);

      const top = document.createElement('li'); top.className = 'spacer'; top.style.height = spacerH + 'px';
      const bottom = document.createElement('li'); bottom.className = 'spacer'; bottom.style.height = spacerH + 'px';
      wheelList.insertBefore(top, wheelList.firstChild);
      wheelList.appendChild(bottom);

      // center first real item
      snapToIndex(0);
    });
  }

  function realItems(){ return Array.from(wheelList.querySelectorAll('li[data-letter]')); }

  function getNearestIndex(){
    const items = realItems();
    if(!items.length) return 0;
    const rect = wheel.getBoundingClientRect();
    const centerY = rect.top + rect.height/2;
    let nearest=0, minDist=Infinity;
    items.forEach((ch,i)=>{
      const r = ch.getBoundingClientRect();
      const c = r.top + r.height/2;
      const d = Math.abs(centerY - c);
      if(d < minDist){ minDist = d; nearest = i; }
    });
    return nearest;
  }

  function snapToIndex(idx){
    const items = realItems();
    if(!items[idx]) return;
    // set flag to ignore scroll events while snapping
    isSnapping = true;
    clearTimeout(snapTimer);

    const rect = wheel.getBoundingClientRect();
    const itemRect = items[idx].getBoundingClientRect();
    const offset = (itemRect.top + itemRect.height/2) - (rect.top + rect.height/2);
    wheel.scrollBy({top: offset, left:0, behavior:'smooth'});

    // safety: unset snapping after animation window
    snapTimer = setTimeout(()=>{ isSnapping = false; }, 300);
    setSelectedByIndex(idx);
  }

  function setSelectedByIndex(idx){
    const items = realItems();
    items.forEach((c,i)=> c.classList.toggle('selected', i === idx));
    const chosen = items[idx]?.dataset?.letter || '—';
    selectedValue.textContent = chosen;
    renderAccordionForLetter(chosen);
  }

  // debounce helper for user scroll end
  function debounce(fn, ms=120){ let t; return (...a)=>{ clearTimeout(t); t = setTimeout(()=>fn(...a), ms); }; }
  const onScrollEnd = debounce(()=>{
    if(isSnapping) return; // ignore if programmatically snapping
    const idx = getNearestIndex();
    snapToIndex(idx);
  }, 120);

  // render accordion (emotions)
  function renderAccordionForLetter(letter){
    accordion.innerHTML = '';
    if(!letter || !DATA[letter] || Object.keys(DATA[letter]).length === 0){
      const p = document.createElement('p'); p.style.color = 'var(--muted)'; p.textContent = 'No emotions added for this letter yet.'; accordion.appendChild(p); return;
    }
    Object.keys(DATA[letter]).forEach(em=>{
      const item = document.createElement('div'); item.className = 'acc-item';
      const head = document.createElement('div'); head.className = 'acc-head'; head.tabIndex = 0; head.setAttribute('role','button'); head.setAttribute('aria-expanded','false');
      const left = document.createElement('div');
      const title = document.createElement('div'); title.className = 'acc-title'; title.textContent = em;
      const sub = document.createElement('div'); sub.className = 'acc-sub'; sub.textContent = `${DATA[letter][em].length} verses`;
      left.appendChild(title); left.appendChild(sub);
      const caret = document.createElement('div'); caret.textContent = '▸'; caret.style.opacity = 0.7;
      head.appendChild(left); head.appendChild(caret);
      const body = document.createElement('div'); body.className = 'acc-body';
      DATA[letter][em].forEach(v=>{
        const p = document.createElement('p'); p.innerHTML = `<strong style="color:var(--text)">${v.verse}</strong><br/><span style="color:var(--muted)">${v.text}</span>`; p.style.marginBottom='10px';
        body.appendChild(p);
      });
      head.addEventListener('click', ()=>{ const open = body.style.display==='block'; body.style.display = open ? 'none' : 'block'; head.setAttribute('aria-expanded', (!open).toString()); caret.style.transform = open ? 'rotate(0deg)' : 'rotate(90deg)'; });
      head.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); head.click(); }});
      item.appendChild(head); item.appendChild(body); accordion.appendChild(item);
    });
  }

  // events
  wheelList.addEventListener('click', ev=>{
    const li = ev.target.closest('li[data-letter]');
    if(!li) return;
    const idx = realItems().indexOf(li);
    if(idx>=0) snapToIndex(idx);
  });

  wheel.addEventListener('scroll', ()=>{ if(isSnapping) return; onScrollEnd(); });
  wheel.addEventListener('keydown', (e)=>{
    const items = realItems();
    const current = items.findIndex(c => c.classList.contains('selected'));
    if(e.key === 'ArrowDown' || e.key === 'ArrowRight'){ snapToIndex(Math.min(items.length-1, current+1)); }
    else if(e.key === 'ArrowUp' || e.key === 'ArrowLeft'){ snapToIndex(Math.max(0, current-1)); }
    else if(e.key === 'Home'){ snapToIndex(0); }
    else if(e.key === 'End'){ snapToIndex(items.length-1); }
  });

  // init
  window.addEventListener('load', ()=>{ buildWheel(); });
  // helper
  window.selectLetter = L => { const idx = LETTERS.indexOf(L); if(idx>=0) snapToIndex(idx); };
</script>
</body>
</html>
